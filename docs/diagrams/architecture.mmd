graph TB
    subgraph Browser["Browser"]
        Host["üñ•Ô∏è Host<br/>(quiz upload,<br/>game control)"]
        Player["üéÆ Players<br/>(join, answer)"]
    end

    subgraph Frontend["Frontend ‚Äî React SPA (localhost:5173)"]
        App["App.tsx<br/>(routing)"]

        subgraph Pages["Pages"]
            HomePage["HomePage"]
            HostPage["HostPage"]
            PlayerPage["PlayerPage"]
        end

        subgraph Hooks["Hooks"]
            useWS["useWebSocket"]
            useGS["useGameState"]
        end

        subgraph Components["Components"]
            QuizUpload["QuizUpload"]
            JoinForm["JoinForm +<br/>AvatarPickerModal"]
            HostDashboard["HostDashboard"]
            Lobby["Lobby"]
            Question["Question"]
            Leaderboard["Leaderboard"]
        end

        subgraph Services["Services"]
            API["api.ts<br/>(REST client)"]
            WsUrl["ws-url.ts"]
            Messages["messages.ts<br/>(type definitions)"]
        end
    end

    subgraph Backend["Backend ‚Äî Rust / Axum (localhost:3000)"]
        subgraph Handlers["Handlers"]
            QuizUploadH["quiz_upload.rs<br/>POST /api/upload"]
            SessionH["session.rs<br/>GET /api/session/:code"]
            WsHostH["ws.rs<br/>GET /ws/host/:code"]
            WsPlayerH["ws.rs<br/>GET /ws/player/:code"]
        end

        subgraph Services_BE["Services"]
            SessionMgr["session_manager.rs<br/>(create / lookup sessions)"]
            GameEngine["game_engine.rs<br/>(question flow, timer,<br/>scoring rule dispatch,<br/>broadcast events)"]
        end

        subgraph Models["Models"]
            SessionM["GameSession<br/>(status, players,<br/>current question,<br/>scoring_rule)"]
            ScoringRule["ScoringRule<br/>(SteppedDecay /<br/>LinearDecay / FixedScore)"]
            QuizM["Quiz<br/>(questions, options)"]
            PlayerM["Player<br/>(name, avatar,<br/>score, connection)"]
            Leaderboard_BE["LeaderboardEntry<br/>(compute_leaderboard)"]
        end

        Broadcast["tokio::broadcast<br/>GameEvent channel<br/>(BroadcastAll / HostOnly / PlayerOnly)"]
        State["AppState<br/>Arc&lt;SessionManager&gt;<br/>Config"]
    end

    Host --> App
    Player --> App
    App --> Pages
    Pages --> Hooks
    Pages --> Components
    Hooks --> Services
    Components --> Services

    API -- "REST<br/>HTTP/JSON" --> QuizUploadH
    API -- "REST<br/>HTTP/JSON" --> SessionH
    useWS -- "WebSocket<br/>/ws/host/:code" --> WsHostH
    useWS -- "WebSocket<br/>/ws/player/:code" --> WsPlayerH

    WsHostH --> SessionMgr
    WsHostH --> Broadcast
    WsPlayerH --> SessionMgr
    WsPlayerH --> Broadcast
    QuizUploadH --> SessionMgr
    SessionH --> SessionMgr

    SessionMgr --> State
    GameEngine --> Broadcast
    GameEngine --> Leaderboard_BE

    SessionMgr --> SessionM
    SessionM --> ScoringRule
    SessionM --> QuizM
    SessionM --> PlayerM
